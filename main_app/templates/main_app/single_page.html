{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="{% static 'main_app/single_page.css' %}">
  <link rel="icon" href="{% static 'main_app/img/logo.ico' %}">
  <title>{{ attr_obj.title }}</title>
</head>

<body>
  <main>
    <section class="container2 s1ip">
      <div class="menu">
        <a href='{% url "main_page" %}' class="backBtn">На главную</a>
        <div>
          <a href="{% if last.link_pk %}{% url 'single_page' last.link_pk %}{% endif %}"
          class="last {% if not last.link_pk %}unactive{% endif %}"
          title="{% if last.link_pk %}{{ last.title }}{% endif %}">
          <div></div></a>
          <a href="{% if next.link_pk %}{% url 'single_page' next.link_pk %}{% endif %}"
          class="next {% if not next.link_pk %}unactive{% endif %}"
          title="{% if next.link_pk %}{{ next.title }}{% endif %}">
          <div></div></a>
        </div>
      </div>
      <h2 class="h1Text">{{ attr_obj.title }}</h2>
      <div>
        <div class="posterBlock2">
          <img id="mainImg" src="{{ media_url }}{{ attr_obj.img1 }}" alt="Картинка 1">
          <img id="secImg" src="{{ media_url }}{{ attr_obj.img2 }}" alt="Картинка 2">
        </div>
        <p id="mainText">{{ attr_obj.full_text }}</p>
      </div>
      <div class="posterBlock2">
        <div>
          <div></div>
          <a class="map">
            <iframe
              src="https://yandex.ru/map-widget/v1/?um=constructor%3Afafabcc11bceef9db2295de3e10e0eaff88e7c49b1a72750457d4d6d825a5b37&amp;source=constructor"
              width="100%" height="400" frameborder="0"></iframe>
          </a>
        </div>
      </div>
      <div class="posterBlock2">
        <div>
          <div></div>
            <div class="comment-form">
                <h3>Оставьте комментарий</h3>
                <form id="commentForm" method='POST'>
                    {% csrf_token %}
                    <input id='name_input' type="text" name="name" placeholder="Имя">
                    <input id='email_input' type="email" name="email" placeholder="Почта">
                    <textarea id='comment_input' name="comment" placeholder="Комментарий"></textarea>
                    <button type="submit">Отправить</button>
                </form>
            </div>
        </div>
      </div>
    <div class='commets_block'>
      <h3>
        Комментарии
        <span class="comments-number">{{ comments_num }}</span>  
      </h3>
      {% for el in comm_obj %}
        <div class='comment_card'>
          <div>
            <div>
              <span>{{ el.name }}</span>
              <a href="mailto:{{ el.email }}">
                <svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" width="512" height="512" x="0" y="0" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512" xml:space="preserve"><g><path d="M469.333 64H42.667C19.135 64 0 83.135 0 106.667v298.667C0 428.865 19.135 448 42.667 448h426.667C492.865 448 512 428.865 512 405.333V106.667C512 83.135 492.865 64 469.333 64zM42.667 85.333h426.667c1.572 0 2.957.573 4.432.897-36.939 33.807-159.423 145.859-202.286 184.478-3.354 3.021-8.76 6.625-15.479 6.625s-12.125-3.604-15.49-6.635C197.652 232.085 75.161 120.027 38.228 86.232c1.478-.324 2.866-.899 4.439-.899zm-21.334 320V106.667c0-2.09.63-3.986 1.194-5.896 28.272 25.876 113.736 104.06 169.152 154.453C136.443 302.671 50.957 383.719 22.46 410.893c-.503-1.814-1.127-3.588-1.127-5.56zm448 21.334H42.667c-1.704 0-3.219-.594-4.81-.974 29.447-28.072 115.477-109.586 169.742-156.009a7980.773 7980.773 0 0 0 18.63 16.858c8.792 7.938 19.083 12.125 29.771 12.125s20.979-4.188 29.76-12.115a8178.815 8178.815 0 0 0 18.641-16.868c54.268 46.418 140.286 127.926 169.742 156.009-1.591.38-3.104.974-4.81.974zm21.334-21.334c0 1.971-.624 3.746-1.126 5.56-28.508-27.188-113.984-108.227-169.219-155.668 55.418-50.393 140.869-128.57 169.151-154.456.564 1.91 1.194 3.807 1.194 5.897v298.667z" fill="#000000" opacity="1" data-original="#000000"></path></g></svg>
                {{ el.email }}
              </a>
            </div>
            <span>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><g><path d="M256 9C119.804 9 9 119.804 9 256s110.804 247 247 247 247-110.804 247-247S392.196 9 256 9zm0 470C133.037 479 33 378.963 33 256 33 133.038 133.037 33 256 33s223 100.038 223 223c0 122.963-100.037 223-223 223zm92.613-223c0 6.628-5.372 12-12 12H256c-6.628 0-12-5.372-12-12V149.136c0-6.627 5.372-12 12-12s12 5.373 12 12V244h68.613c6.628 0 12 5.373 12 12zM244 91.125V55.329c0-6.627 5.373-12 12-12s12 5.373 12 12v35.797c0 6.627-5.373 12-12 12s-12-5.373-12-12.001zm120.099 56.776c-4.687-4.687-4.687-12.285 0-16.971l25.312-25.312c4.687-4.687 12.284-4.686 16.971 0 4.687 4.687 4.687 12.285 0 16.971l-25.312 25.312a11.964 11.964 0 0 1-8.485 3.515 11.959 11.959 0 0 1-8.486-3.515zM468.672 256c0 6.627-5.373 12-12 12h-35.797c-6.627 0-12-5.373-12-12s5.373-12 12-12h35.797c6.627 0 12 5.373 12 12zm-62.29 133.411c4.687 4.687 4.687 12.284 0 16.971-2.343 2.343-5.414 3.515-8.485 3.515s-6.143-1.172-8.485-3.515L364.1 381.07c-4.687-4.687-4.687-12.284 0-16.971 4.686-4.686 12.285-4.686 16.971 0zM268 420.875v35.796c0 6.628-5.373 12-12 12s-12-5.372-12-12v-35.796c0-6.627 5.373-12 12-12s12 5.373 12 12zm-120.099-56.776c4.687 4.687 4.687 12.284 0 16.971l-25.312 25.312c-2.343 2.343-5.414 3.515-8.485 3.515s-6.142-1.172-8.485-3.515c-4.687-4.687-4.687-12.284 0-16.971l25.312-25.312c4.685-4.686 12.283-4.686 16.97 0zM103.126 256c0 6.627-5.373 12-12 12H55.329c-6.627 0-12-5.373-12-12s5.373-12 12-12h35.797c6.627 0 12 5.373 12 12zm44.775-125.069c4.687 4.687 4.687 12.285 0 16.971a11.964 11.964 0 0 1-8.485 3.515 11.958 11.958 0 0 1-8.485-3.515l-25.312-25.312c-4.687-4.687-4.687-12.285 0-16.971 4.687-4.687 12.284-4.686 16.971 0z" fill="#000000" opacity="1" data-original="#000000"></path></g></svg>
              {{ el.created_at }}
            </span>
          </div>
          <span>{{ el.comment }}</span>
        </div>
      {% endfor %}
    </div>
      <div class="menu" style="margin: 40px 0;">
        <a href='{% url "main_page" %}' class="backBtn">На главную</a>
        <div>
          <a href="{% if last.link_pk %}{% url 'single_page' last.link_pk %}{% endif %}"
          class="last {% if not last.link_pk %}unactive{% endif %}"
          title="{% if last.link_pk %}{{ last.title }}{% endif %}">
          <div></div></a>
          <a href="{% if next.link_pk %}{% url 'single_page' next.link_pk %}{% endif %}"
          class="next {% if not next.link_pk %}unactive{% endif %}"
          title="{% if next.link_pk %}{{ next.title }}{% endif %}">
          <div></div></a>
        </div>
      </div>
    </section>
  </main>
  <script type="text/javascript" src='{% static "main_app/js/jquery.min.js" %}'></script>
  <script type="text/javascript" src='{% static "main_app/js/single_page.js" %}'></script>
  <script>
      $(document).ready(function() {
        $('#commentForm').submit(function(event) {
          event.preventDefault(); 
          formData = new FormData(commentForm);
          formData.append('page_pk', '{{ pk }}');
          request = new XMLHttpRequest();
          request.onloadend = function() {
            if (request.status == 200) {
              $('.commets_block').append(`
                  <div class='comment_card'>
                    <div>
                      <div>
                        <span>${ $('#name_input').val() }</span>
                        <a href="mailto:${ $('#email_input').val() }">
                          <svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" width="512" height="512" x="0" y="0" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512" xml:space="preserve"><g><path d="M469.333 64H42.667C19.135 64 0 83.135 0 106.667v298.667C0 428.865 19.135 448 42.667 448h426.667C492.865 448 512 428.865 512 405.333V106.667C512 83.135 492.865 64 469.333 64zM42.667 85.333h426.667c1.572 0 2.957.573 4.432.897-36.939 33.807-159.423 145.859-202.286 184.478-3.354 3.021-8.76 6.625-15.479 6.625s-12.125-3.604-15.49-6.635C197.652 232.085 75.161 120.027 38.228 86.232c1.478-.324 2.866-.899 4.439-.899zm-21.334 320V106.667c0-2.09.63-3.986 1.194-5.896 28.272 25.876 113.736 104.06 169.152 154.453C136.443 302.671 50.957 383.719 22.46 410.893c-.503-1.814-1.127-3.588-1.127-5.56zm448 21.334H42.667c-1.704 0-3.219-.594-4.81-.974 29.447-28.072 115.477-109.586 169.742-156.009a7980.773 7980.773 0 0 0 18.63 16.858c8.792 7.938 19.083 12.125 29.771 12.125s20.979-4.188 29.76-12.115a8178.815 8178.815 0 0 0 18.641-16.868c54.268 46.418 140.286 127.926 169.742 156.009-1.591.38-3.104.974-4.81.974zm21.334-21.334c0 1.971-.624 3.746-1.126 5.56-28.508-27.188-113.984-108.227-169.219-155.668 55.418-50.393 140.869-128.57 169.151-154.456.564 1.91 1.194 3.807 1.194 5.897v298.667z" fill="#000000" opacity="1" data-original="#000000"></path></g></svg>
                          ${ $('#email_input').val() }
                        </a>
                      </div>
                      <span>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><g><path d="M256 9C119.804 9 9 119.804 9 256s110.804 247 247 247 247-110.804 247-247S392.196 9 256 9zm0 470C133.037 479 33 378.963 33 256 33 133.038 133.037 33 256 33s223 100.038 223 223c0 122.963-100.037 223-223 223zm92.613-223c0 6.628-5.372 12-12 12H256c-6.628 0-12-5.372-12-12V149.136c0-6.627 5.372-12 12-12s12 5.373 12 12V244h68.613c6.628 0 12 5.373 12 12zM244 91.125V55.329c0-6.627 5.373-12 12-12s12 5.373 12 12v35.797c0 6.627-5.373 12-12 12s-12-5.373-12-12.001zm120.099 56.776c-4.687-4.687-4.687-12.285 0-16.971l25.312-25.312c4.687-4.687 12.284-4.686 16.971 0 4.687 4.687 4.687 12.285 0 16.971l-25.312 25.312a11.964 11.964 0 0 1-8.485 3.515 11.959 11.959 0 0 1-8.486-3.515zM468.672 256c0 6.627-5.373 12-12 12h-35.797c-6.627 0-12-5.373-12-12s5.373-12 12-12h35.797c6.627 0 12 5.373 12 12zm-62.29 133.411c4.687 4.687 4.687 12.284 0 16.971-2.343 2.343-5.414 3.515-8.485 3.515s-6.143-1.172-8.485-3.515L364.1 381.07c-4.687-4.687-4.687-12.284 0-16.971 4.686-4.686 12.285-4.686 16.971 0zM268 420.875v35.796c0 6.628-5.373 12-12 12s-12-5.372-12-12v-35.796c0-6.627 5.373-12 12-12s12 5.373 12 12zm-120.099-56.776c4.687 4.687 4.687 12.284 0 16.971l-25.312 25.312c-2.343 2.343-5.414 3.515-8.485 3.515s-6.142-1.172-8.485-3.515c-4.687-4.687-4.687-12.284 0-16.971l25.312-25.312c4.685-4.686 12.283-4.686 16.97 0zM103.126 256c0 6.627-5.373 12-12 12H55.329c-6.627 0-12-5.373-12-12s5.373-12 12-12h35.797c6.627 0 12 5.373 12 12zm44.775-125.069c4.687 4.687 4.687 12.285 0 16.971a11.964 11.964 0 0 1-8.485 3.515 11.958 11.958 0 0 1-8.485-3.515l-25.312-25.312c-4.687-4.687-4.687-12.285 0-16.971 4.687-4.687 12.284-4.686 16.971 0z" fill="#000000" opacity="1" data-original="#000000"></path></g></svg>
                        Только что
                      </span>
                    </div>
                    <span>${ $('#comment_input').val() }</span>
                  </div>
              `);
              $('.comments-number').html(+$('.comments-number').html() + 1);
              $("#commentForm").children().val('');
            }
          };
          request.open("POST", `{% url "single_page" pk %}`);
          request.send(formData);
        });
      });
    </script>
</body>

</html>